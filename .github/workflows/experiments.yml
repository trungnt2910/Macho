name: 'Experiment stuff'
on: push

jobs:
  test:

    name: Do some experiments on MacOS
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2

    - name: Build load-main
      run: |
        gcc Experiments/load-main/bundle.c -bundle -o Experiments/load-main/bundle
        gcc Experiments/load-main/macho.c Experiments/load-main/main.c -o Experiments/load-main/macho
        ./Experiments/load-main/macho ./Experiments/load-main/bundle

    - name: Publish load-main binaries
      uses: actions/upload-artifact@v2
      with:
        name: load-main
        path: |
          ./Experiments/load-main/macho
          ./Experiments/load-main/bundle


    - name: Build load-foo
      run: |
        gcc Experiments/load-foo/bundle.c -bundle -o Experiments/load-foo/bundle.so
        gcc Experiments/load-foo/macho.c Experiments/load-foo/main.c -o Experiments/load-foo/macho
        ./Experiments/load-foo/macho ./Experiments/load-foo/bundle.so

    - name: Publish load-foo binaries
      uses: actions/upload-artifact@v2
      with:
        name: load-foo
        path: |
          ./Experiments/load-foo/macho
          ./Experiments/load-foo/bundle
